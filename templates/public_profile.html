{% extends "base.html" %}

{% block content %}
<div class="bg-gray-900 min-h-screen py-8 text-gray-100 font-sans" x-data="publicProfile({{ profile_id }})">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="bg-gray-800 border border-gray-700 shadow-xl overflow-hidden sm:rounded-xl" x-show="!loading">
            <div
                class="px-6 py-6 sm:px-8 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-6 bg-gray-800/50">
                <div class="flex items-center gap-4 w-full sm:w-auto">
                    <!-- Back Button -->
                    <button
                        @click="window.history.length > 1 ? window.history.back() : window.location.href='/dashboard'"
                        class="flex-shrink-0 w-10 h-10 flex items-center justify-center rounded-full bg-gray-700 hover:bg-gray-600 text-gray-400 hover:text-white transition-all shadow-md"
                        title="Go Back">
                        <i class="fas fa-arrow-left"></i>
                    </button>

                    <div class="flex items-center space-x-5">
                        <template x-if="profile.profile_picture">
                            <img :src="profile.profile_picture"
                                class="h-20 w-20 rounded-full object-cover ring-4 ring-gray-700 shadow-lg">
                        </template>
                        <template x-if="!profile.profile_picture">
                            <span
                                class="inline-flex h-20 w-20 items-center justify-center rounded-full bg-gray-700 text-gray-400 ring-4 ring-gray-700 shadow-lg">
                                <i class="fas fa-user text-4xl"></i>
                            </span>
                        </template>
                        <div>
                            <h3 class="text-3xl leading-tight font-bold text-white tracking-tight"
                                x-text="profile.full_name"></h3>
                            <div class="flex items-center gap-3 mt-1">
                                <p class="text-sm font-medium text-blue-400 uppercase tracking-wider"
                                    x-text="profile.account_type"></p>
                                <template x-if="profile.verified">
                                    <span
                                        class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-semibold bg-green-900/50 text-green-400 border border-green-700/50">
                                        <i class="fas fa-check-circle mr-1.5"></i> Verified
                                    </span>
                                </template>
                            </div>
                        </div>
                    </div>
                </div>
                <div>
                    <!-- Message Button -->
                    <a :href="'/messages?recipient_id=' + profile.id"
                        class="inline-flex items-center px-6 py-3 border border-transparent shadow-lg text-sm font-medium rounded-lg text-white bg-blue-600 hover:bg-blue-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-blue-500 transition-all transform hover:scale-105 active:scale-95">
                        <i class="fas fa-envelope mr-2.5"></i> Send Message
                    </a>
                </div>
            </div>

            <div class="border-t border-gray-700 px-6 py-6 sm:px-8 bg-gray-800/30">
                <dl class="grid grid-cols-1 gap-x-4 gap-y-8 sm:grid-cols-2">
                    <div class="sm:col-span-1">
                        <dt class="text-xs font-semibold text-gray-500 uppercase tracking-wide">Location</dt>
                        <dd class="mt-2 text-base text-gray-200" x-text="profile.location || 'Not specified'"></dd>
                    </div>
                    <div class="sm:col-span-1">
                        <dt class="text-xs font-semibold text-gray-500 uppercase tracking-wide">Joined</dt>
                        <dd class="mt-2 text-base text-gray-200"
                            x-text="new Date(profile.created_at).toLocaleDateString()"></dd>
                    </div>
                    <div class="sm:col-span-2">
                        <dt class="text-xs font-semibold text-gray-500 uppercase tracking-wide">Bio</dt>
                        <dd class="mt-2 text-base text-gray-300 leading-relaxed"
                            x-text="profile.bio || 'No bio available.'"></dd>
                    </div>
                </dl>
            </div>

            <!-- Worker Specific Section -->
            <template x-if="profile.worker_profile">
                <div class="border-t border-gray-700 px-6 py-6 sm:px-8 bg-gray-900/20">
                    <h4 class="text-lg font-bold text-white mb-6 flex items-center"><i
                            class="fas fa-briefcase text-gray-500 mr-2"></i> Worker Profile</h4>
                    <dl class="grid grid-cols-1 gap-x-4 gap-y-8 sm:grid-cols-2">
                        <div class="sm:col-span-1">
                            <dt class="text-xs font-semibold text-gray-500 uppercase tracking-wide">Skills</dt>
                            <dd class="mt-2 flex flex-wrap gap-2">
                                <template x-for="skill in (profile.worker_profile.skills || '').split(',')">
                                    <span
                                        class="inline-flex items-center px-3 py-1 rounded-md text-sm font-medium bg-gray-700 text-gray-200 border border-gray-600"
                                        x-text="skill.trim()"></span>
                                </template>
                            </dd>
                        </div>
                        <div class="sm:col-span-1">
                            <dt class="text-xs font-semibold text-gray-500 uppercase tracking-wide">Hourly Rate</dt>
                            <dd class="mt-2 text-xl font-bold text-green-400"
                                x-text="'â‚¦' + profile.worker_profile.hourly_rate + '/hr'"></dd>
                        </div>
                    </dl>
                </div>
            </template>

            <div class="border-t border-gray-700 px-6 py-6 sm:px-8 bg-gray-800/30">
                <h4 class="text-lg font-bold text-white mb-6 flex items-center"><i
                        class="fas fa-store text-gray-500 mr-2"></i> Active Listings</h4>
                <div class="grid grid-cols-1 gap-y-10 gap-x-6 sm:grid-cols-2 lg:grid-cols-3 xl:gap-x-8">
                    <!-- Placeholder for listings (Implement fetch if needed) -->
                    <div class="col-span-full group relative bg-gray-900/50 border border-gray-700 rounded-xl p-8 text-center"
                        x-show="listings.length === 0">
                        <div class="mx-auto h-12 w-12 text-gray-600 mb-3"><i class="fas fa-box-open text-3xl"></i></div>
                        <p class="text-gray-400 font-medium">No active listings to show</p>
                    </div>
                </div>
            </div>
        </div>

        <div x-show="loading" class="flex justify-center py-20">
            <i class="fas fa-circle-notch fa-spin text-4xl text-blue-500"></i>
        </div>

        <div x-show="error" class="bg-red-900/50 border border-red-800 p-4 rounded-xl mt-4" style="display: none;">
            <div class="flex">
                <div class="flex-shrink-0">
                    <i class="fas fa-exclamation-circle text-red-500"></i>
                </div>
                <div class="ml-3">
                    <h3 class="text-sm font-medium text-red-200" x-text="error"></h3>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function publicProfile(profileId) {
        return {
            profileId: profileId,
            profile: {},
            listings: [],
            loading: true,
            error: null,

            async init() {
                try {
                    const res = await fetch(`/api/users/${this.profileId}`);
                    if (res.ok) {
                        this.profile = await res.json();
                        // this.fetchListings(); // Future: Implement fetching listings
                    } else {
                        this.error = 'Profile not found';
                    }
                } catch (e) {
                    this.error = 'Error loading profile';
                    console.error(e);
                } finally {
                    this.loading = false;
                }
            }
        }
    }
</script>
{% endblock %}