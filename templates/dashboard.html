{% extends "base.html" %}

{% block title %}Dashboard - Farmly{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-900 text-gray-100 font-sans transition-colors duration-200" x-data="dashboard()">
    <!-- Background Pattern -->
    <div class="fixed inset-0 z-0 pointer-events-none opacity-40 dark:opacity-20"
        style="background-image: radial-gradient(#cbd5e1 1px, transparent 1px); background-size: 24px 24px;">
    </div>

    <div class="relative bg-primary-800 pb-32 shadow-xl">
        <div class="absolute inset-0">
            <img class="w-full h-full object-cover"
                src="https://images.unsplash.com/photo-1625246333195-78d9c38ad449?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80"
                alt="Agriculture Background">
            <div class="absolute inset-0 bg-gradient-to-b from-primary-900/90 to-primary-800/95 mix-blend-multiply"
                aria-hidden="true"></div>
        </div>
        <header class="relative py-10 z-20">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-center">
                <h1 class="text-3xl font-bold leading-tight text-white flex flex-wrap items-center gap-3">
                    <span>Welcome back, <span
                            x-text="user.full_name ? user.full_name.toLowerCase().replace(/(?:^|\s)\w/g, function(c) { return c.toUpperCase(); }) : ''"></span></span>

                    <!-- Verification Badge -->
                    <template x-if="['farmer', 'realtor', 'worker'].includes(user.account_type)">
                        <div class="relative group inline-flex items-center">
                            <!-- Badge Trigger -->
                            <span
                                :class="user.verified ? 'bg-green-100 text-green-800 border-green-200 dark:bg-green-900 dark:text-green-300 dark:border-green-700' : 'bg-yellow-100 text-yellow-800 border-yellow-200 dark:bg-yellow-900 dark:text-yellow-300 dark:border-yellow-700'"
                                class="px-3 py-1 rounded-full text-xs font-medium cursor-help flex items-center gap-1.5 border shadow-sm transition-transform hover:scale-105">
                                <i
                                    :class="user.verified ? 'fa-solid fa-check-circle' : 'fa-solid fa-exclamation-circle'"></i>
                                <span x-text="user.verified ? 'Verified' : 'Unverified'"></span>
                            </span>

                            <!-- Tooltip -->
                            <div
                                class="absolute left-0 top-full mt-3 w-72 p-4 bg-white dark:bg-gray-800 rounded-xl shadow-2xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50 text-sm text-gray-700 dark:text-gray-300 border border-gray-100 dark:border-gray-700 transform origin-top-left">
                                <!-- Verified Content -->
                                <template x-if="user.verified">
                                    <div class="text-center">
                                        <div class="text-green-500 text-3xl mb-2 animate-bounce"><i
                                                class="fa-solid fa-shield-heart"></i></div>
                                        <p class="font-bold text-gray-900 dark:text-white text-base">You're fully
                                            verified!</p>
                                        <p class="mt-2 text-xs text-gray-500 dark:text-gray-400 leading-relaxed">
                                            Awesome! You're a trusted member of the Farmly community. You have unlocked
                                            full access to all features, higher limits, and the trust of your peers.
                                            Keep growing! ðŸŒ±âœ¨
                                        </p>
                                    </div>
                                </template>

                                <!-- Unverified Content -->
                                <template x-if="!user.verified">
                                    <div>
                                        <div class="text-yellow-500 text-2xl mb-2 flex justify-center"><i
                                                class="fa-solid fa-triangle-exclamation"></i></div>
                                        <p class="font-bold text-gray-900 dark:text-white mb-2 text-center">Account
                                            Unverified</p>
                                        <p class="text-xs text-gray-500 dark:text-gray-400 mb-3 text-center">Your
                                            account is currently limited. Verify your identity to unlock:</p>
                                        <ul
                                            class="space-y-2 text-xs text-gray-600 dark:text-gray-300 bg-gray-50 dark:bg-gray-700 p-3 rounded-lg">
                                            <li class="flex items-start gap-2">
                                                <i class="fa-solid fa-ban text-red-400 mt-0.5"></i>
                                                <span>Restricted transaction limits</span>
                                            </li>
                                            <li class="flex items-start gap-2">
                                                <i class="fa-solid fa-eye-slash text-red-400 mt-0.5"></i>
                                                <span>Lower visibility in search results</span>
                                            </li>
                                            <li class="flex items-start gap-2">
                                                <i class="fa-solid fa-lock text-red-400 mt-0.5"></i>
                                                <span>No access to premium deals</span>
                                            </li>
                                        </ul>
                                        <a href="/settings?tab=verification"
                                            class="block mt-3 text-center text-xs font-bold text-white bg-primary-600 hover:bg-primary-700 py-2 rounded-md transition-colors shadow-sm">
                                            Complete Verification Now &rarr;
                                        </a>
                                    </div>
                                </template>

                                <!-- Arrow -->
                                <div
                                    class="absolute -top-2 left-6 w-4 h-4 bg-white dark:bg-gray-800 transform rotate-45 border-t border-l border-gray-100 dark:border-gray-700">
                                </div>
                            </div>
                        </div>
                    </template>
                </h1>
                <template x-if="user.account_type === 'farmer'">
                    <a href="/jobs/create"
                        class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-primary-700 bg-white dark:bg-gray-700 dark:text-white hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-primary-800 focus:ring-white">
                        <i class="fas fa-plus mr-2"></i> Post a Job
                    </a>
                </template>
                <template x-if="user.account_type === 'realtor'">
                    <a href="/marketplace/create"
                        class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-primary-700 bg-white dark:bg-gray-700 dark:text-white hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-primary-800 focus:ring-white">
                        <i class="fas fa-plus mr-2"></i> List Property
                    </a>
                </template>
            </div>
        </header>
    </div>

    <main class="relative z-10 mt-8">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
            <div class="px-4 py-8 sm:px-0">

                <!-- Quick Actions Grid -->
                <div class="mb-8">
                    <h3 class="text-lg font-medium text-gray-300 mb-4 px-1">Quick Actions</h3>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                        <!-- AI Produce Assistant (Farmers Only) -->
                        <template x-if="user.account_type === 'farmer'">
                            <a href="/tools/produce-assistant"
                                class="bg-gray-800 hover:bg-gray-700 border border-emerald-500/30 rounded-xl p-6 flex flex-col items-center justify-center text-center transition-all duration-200 group shadow-lg hover:shadow-xl hover:-translate-y-1 relative overflow-hidden">
                                <div
                                    class="absolute inset-0 bg-gradient-to-br from-emerald-500/10 to-cyan-500/10 opacity-0 group-hover:opacity-100 transition-opacity">
                                </div>
                                <div
                                    class="h-12 w-12 rounded-full bg-gradient-to-br from-emerald-500 to-cyan-600 flex items-center justify-center mb-3 transition-transform group-hover:scale-110 shadow-lg shadow-emerald-500/20">
                                    <i class="fas fa-robot text-white text-xl"></i>
                                </div>
                                <span
                                    class="text-gray-100 font-bold group-hover:text-emerald-400 transition-colors z-10">AI
                                    Assistant</span>
                                <span class="text-xs text-gray-400 mt-1 z-10">Optimize harvest</span>
                            </a>
                        </template>
                        <!-- Messages -->
                        <a href="/messages"
                            class="bg-gray-800 hover:bg-gray-700 border border-gray-700 rounded-xl p-6 flex flex-col items-center justify-center text-center transition-all duration-200 group shadow-lg hover:shadow-xl hover:-translate-y-1">
                            <div
                                class="h-12 w-12 rounded-full bg-blue-900/20 flex items-center justify-center mb-3 group-hover:bg-blue-900/40 transition-colors ring-1 ring-blue-900/30">
                                <i class="fas fa-envelope text-blue-400 text-xl"></i>
                            </div>
                            <span
                                class="text-gray-100 font-semibold group-hover:text-blue-400 transition-colors">Messages</span>
                            <span class="text-xs text-gray-500 mt-1">Check inbox</span>
                        </a>

                        <!-- Profile Settings -->
                        <a href="/settings"
                            class="bg-gray-800 hover:bg-gray-700 border border-gray-700 rounded-xl p-6 flex flex-col items-center justify-center text-center transition-all duration-200 group shadow-lg hover:shadow-xl hover:-translate-y-1">
                            <div
                                class="h-12 w-12 rounded-full bg-purple-900/20 flex items-center justify-center mb-3 group-hover:bg-purple-900/40 transition-colors ring-1 ring-purple-900/30">
                                <i class="fas fa-user-cog text-purple-400 text-xl"></i>
                            </div>
                            <span class="text-gray-100 font-semibold group-hover:text-purple-400 transition-colors">My
                                Profile</span>
                            <span class="text-xs text-gray-500 mt-1">Update details</span>
                        </a>

                        <!-- Wallet -->
                        <a href="/wallet"
                            class="bg-gray-800 hover:bg-gray-700 border border-gray-700 rounded-xl p-6 flex flex-col items-center justify-center text-center transition-all duration-200 group shadow-lg hover:shadow-xl hover:-translate-y-1">
                            <div
                                class="h-12 w-12 rounded-full bg-green-900/20 flex items-center justify-center mb-3 group-hover:bg-green-900/40 transition-colors ring-1 ring-green-900/30">
                                <i class="fas fa-wallet text-green-400 text-xl"></i>
                            </div>
                            <span
                                class="text-gray-100 font-semibold group-hover:text-green-400 transition-colors">Wallet</span>
                            <span class="text-xs text-gray-500 mt-1">Manage funds</span>
                        </a>

                        <!-- Forum/Community -->
                        <a href="/forum"
                            class="bg-gray-800 hover:bg-gray-700 border border-gray-700 rounded-xl p-6 flex flex-col items-center justify-center text-center transition-all duration-200 group shadow-lg hover:shadow-xl hover:-translate-y-1">
                            <div
                                class="h-12 w-12 rounded-full bg-yellow-900/20 flex items-center justify-center mb-3 group-hover:bg-yellow-900/40 transition-colors ring-1 ring-yellow-900/30">
                                <i class="fas fa-comments text-yellow-400 text-xl"></i>
                            </div>
                            <span
                                class="text-gray-100 font-semibold group-hover:text-yellow-400 transition-colors">Community</span>
                            <span class="text-xs text-gray-500 mt-1">Join discussions</span>
                        </a>
                    </div>
                </div>

                <!-- Recent Messages Widget (Visible to all) -->
                <div class="mb-8 bg-gray-800 border border-gray-700 shadow-xl rounded-xl overflow-hidden"
                    x-show="recentMessages.length > 0">
                    <div
                        class="px-6 py-5 border-b border-gray-700 flex justify-between items-center bg-gray-800/50 backdrop-blur-sm">
                        <div class="flex items-center gap-3">
                            <div class="p-2 bg-blue-500/10 rounded-lg">
                                <i class="fas fa-envelope text-blue-400"></i>
                            </div>
                            <h3 class="text-lg leading-6 font-semibold text-white">Recent Messages</h3>
                        </div>
                        <a href="/messages"
                            class="text-xs font-medium text-blue-400 hover:text-blue-300 uppercase tracking-wider transition-colors">View
                            All</a>
                    </div>
                    <ul class="divide-y divide-gray-700">
                        <template x-for="msg in recentMessages" :key="msg.partner_id">
                            <li class="hover:bg-gray-700/50 transition-all duration-200 group">
                                <a :href="'/messages?recipient_id=' + msg.partner_id" class="block px-6 py-4">
                                    <div class="flex items-center space-x-4">
                                        <div class="flex-shrink-0 relative">
                                            <template x-if="msg.partner_picture">
                                                <img :src="msg.partner_picture"
                                                    class="h-12 w-12 rounded-full object-cover ring-2 ring-gray-700 group-hover:ring-blue-500/50 transition-all">
                                            </template>
                                            <template x-if="!msg.partner_picture">
                                                <span
                                                    class="inline-flex h-12 w-12 items-center justify-center rounded-full bg-gray-700 text-gray-400 ring-2 ring-gray-600 group-hover:ring-blue-500/50 transition-all">
                                                    <i class="fas fa-user text-lg"></i>
                                                </span>
                                            </template>
                                            <!-- Online Status Indicator (Mock) -->
                                            <span
                                                class="absolute bottom-0 right-0 block h-3 w-3 rounded-full ring-2 ring-gray-800 bg-green-400"></span>
                                        </div>
                                        <div class="flex-1 min-w-0">
                                            <div class="flex justify-between items-baseline mb-1">
                                                <p class="text-sm font-bold text-white group-hover:text-blue-400 transition-colors truncate"
                                                    x-text="msg.partner_name"></p>
                                                <p class="text-xs text-gray-500" x-text="formatDate(msg.time)"></p>
                                            </div>
                                            <p class="text-sm text-gray-400 truncate group-hover:text-gray-300 transition-colors"
                                                x-text="msg.last_message"></p>
                                        </div>
                                    </div>
                                </a>
                            </li>
                        </template>
                    </ul>
                </div>


                <!-- Realtor Dashboard -->
                <template x-if="user.account_type === 'realtor'">
                    <div class="space-y-8">
                        <!-- Stats -->
                        <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4">
                            <div class="bg-white dark:bg-gray-800 overflow-hidden shadow rounded-lg p-5">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0 bg-primary-500 rounded-md p-3">
                                        <i class="fas fa-home text-white text-xl"></i>
                                    </div>
                                    <div class="ml-5 w-0 flex-1">
                                        <dl>
                                            <dt class="text-sm font-medium text-gray-500 dark:text-gray-400 truncate">
                                                Active Listings</dt>
                                            <dd class="text-2xl font-semibold text-gray-900 dark:text-white"
                                                x-text="listings.length"></dd>
                                        </dl>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Listings List -->
                        <div class="bg-white dark:bg-gray-800 shadow rounded-lg overflow-hidden">
                            <div class="px-4 py-5 sm:px-6 border-b border-gray-200 dark:border-gray-700">
                                <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white">My Property
                                    Listings</h3>
                            </div>
                            <ul class="divide-y divide-gray-200 dark:divide-gray-700">
                                <template x-for="listing in listings" :key="listing.id">
                                    <li
                                        class="px-4 py-4 sm:px-6 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center">
                                                <div
                                                    class="flex-shrink-0 h-12 w-12 rounded-md bg-gray-200 dark:bg-gray-600 overflow-hidden">
                                                    <img :src="listing.image_url || 'https://via.placeholder.com/100'"
                                                        class="h-full w-full object-cover">
                                                </div>
                                                <div class="ml-4">
                                                    <div class="text-sm font-medium text-primary-600 truncate"
                                                        x-text="listing.title"></div>
                                                    <div class="text-sm text-gray-500 dark:text-gray-400"
                                                        x-text="'â‚¦' + listing.price"></div>
                                                </div>
                                            </div>
                                            <div class="flex space-x-2">
                                                <a :href="'/marketplace/' + listing.id"
                                                    class="text-gray-400 hover:text-gray-500 dark:hover:text-gray-300">
                                                    <i class="fas fa-eye"></i>
                                                </a>
                                                <a :href="'/marketplace/' + listing.id + '/edit'"
                                                    class="text-blue-400 hover:text-blue-500">
                                                    <i class="fas fa-edit"></i>
                                                </a>
                                            </div>
                                        </div>
                                    </li>
                                </template>
                                <li x-show="listings.length === 0"
                                    class="px-4 py-8 text-center text-gray-500 dark:text-gray-400">
                                    No properties listed yet.
                                </li>
                            </ul>
                        </div>
                    </div>
                </template>

                <!-- Farmer Dashboard -->
                <template x-if="user.account_type === 'farmer'">
                    <div class="space-y-8">
                        <!-- Stats / Quick Actions -->
                        <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4">
                            <div class="bg-white dark:bg-gray-800 overflow-hidden shadow rounded-lg p-5">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0 bg-green-500 rounded-md p-3">
                                        <i class="fas fa-users text-white text-xl"></i>
                                    </div>
                                    <div class="ml-5 w-0 flex-1">
                                        <dl>
                                            <dt class="text-sm font-medium text-gray-500 dark:text-gray-400 truncate">
                                                Hired Workers</dt>
                                            <dd class="text-2xl font-semibold text-gray-900 dark:text-white"
                                                x-text="contracts.length"></dd>
                                        </dl>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-white dark:bg-gray-800 overflow-hidden shadow rounded-lg p-5">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0 bg-blue-500 rounded-md p-3">
                                        <i class="fas fa-briefcase text-white text-xl"></i>
                                    </div>
                                    <div class="ml-5 w-0 flex-1">
                                        <dl>
                                            <dt class="text-sm font-medium text-gray-500 dark:text-gray-400 truncate">
                                                Active Jobs</dt>
                                            <dd class="text-2xl font-semibold text-gray-900 dark:text-white"
                                                x-text="jobs.length"></dd>
                                        </dl>
                                    </div>
                                </div>
                            </div>
                            <!-- Add more stats if needed -->
                        </div>

                        <!-- Hired Workers Section -->
                        <div class="bg-white dark:bg-gray-800 shadow rounded-lg overflow-hidden">
                            <div class="px-4 py-5 sm:px-6 border-b border-gray-200 dark:border-gray-700">
                                <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white">Hired Workers
                                </h3>
                                <p class="mt-1 max-w-2xl text-sm text-gray-500 dark:text-gray-400">Manage your active
                                    contracts and workers.</p>
                            </div>
                            <ul class="divide-y divide-gray-200 dark:divide-gray-700">
                                <template x-for="contract in contracts" :key="contract.id">
                                    <li
                                        class="px-4 py-4 sm:px-6 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                                        <div class="flex items-center justify-between">
                                            <div class="text-sm font-medium text-primary-600 truncate"
                                                x-text="contract.title">
                                            </div>
                                            <div class="ml-2 flex-shrink-0 flex">
                                                <span
                                                    class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full"
                                                    :class="{'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300': contract.status === 'active', 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300': contract.status === 'pending', 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300': contract.status === 'draft'}"
                                                    x-text="contract.status">
                                                </span>
                                            </div>
                                        </div>
                                        <div class="mt-2 sm:flex sm:justify-between">
                                            <div class="sm:flex">
                                                <p class="flex items-center text-sm text-gray-500 dark:text-gray-400">
                                                    <i class="fas fa-user mr-1.5 text-gray-400"></i>
                                                    Worker ID: <span x-text="contract.party_b_id"></span>
                                                </p>
                                            </div>
                                            <div
                                                class="mt-2 flex items-center text-sm text-gray-500 dark:text-gray-400 sm:mt-0">
                                                <i class="fas fa-calendar mr-1.5 text-gray-400"></i>
                                                <p>Created on <span
                                                        x-text="new Date(contract.created_at).toLocaleDateString()"></span>
                                                </p>
                                            </div>
                                        </div>
                                    </li>
                                </template>
                                <li x-show="contracts.length === 0"
                                    class="px-4 py-8 text-center text-gray-500 dark:text-gray-400">
                                    No hired workers yet. <a href="/workers-directory"
                                        class="text-primary-600 hover:text-primary-500">Find workers</a>
                                </li>
                            </ul>
                        </div>

                        <!-- My Job Listings Section -->
                        <div class="bg-white dark:bg-gray-800 shadow rounded-lg overflow-hidden">
                            <div
                                class="px-4 py-5 sm:px-6 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                                <div>
                                    <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white">My Job
                                        Listings</h3>
                                    <p class="mt-1 max-w-2xl text-sm text-gray-500 dark:text-gray-400">Jobs you have
                                        posted.</p>
                                </div>
                                <a href="/jobs/create" class="text-sm text-primary-600 hover:text-primary-500">Post New
                                    Job &rarr;</a>
                            </div>
                            <ul class="divide-y divide-gray-200 dark:divide-gray-700">
                                <template x-for="job in jobs" :key="job.id">
                                    <li
                                        class="px-4 py-4 sm:px-6 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                                        <div class="flex items-center justify-between">
                                            <div class="text-sm font-medium text-primary-600 truncate"
                                                x-text="job.title"></div>
                                            <div class="ml-2 flex-shrink-0 flex items-center space-x-2">
                                                <span
                                                    class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300"
                                                    x-text="job.status"></span>
                                                <a :href="'/jobs/' + job.id + '/edit'"
                                                    class="text-blue-400 hover:text-blue-500">
                                                    <i class="fas fa-edit"></i>
                                                </a>
                                            </div>
                                        </div>
                                        <div class="mt-2 sm:flex sm:justify-between">
                                            <div class="sm:flex">
                                                <p class="flex items-center text-sm text-gray-500 dark:text-gray-400">
                                                    <i class="fas fa-map-marker-alt mr-1.5 text-gray-400"></i>
                                                    <span x-text="job.location"></span>
                                                </p>
                                            </div>
                                            <div
                                                class="mt-2 flex items-center text-sm text-gray-500 dark:text-gray-400 sm:mt-0">
                                                <p>Posted <span
                                                        x-text="new Date(job.created_at).toLocaleDateString()"></span>
                                                </p>
                                            </div>
                                        </div>
                                    </li>
                                </template>
                                <li x-show="jobs.length === 0"
                                    class="px-4 py-8 text-center text-gray-500 dark:text-gray-400">
                                    You haven't posted any jobs yet.
                                </li>
                            </ul>
                        </div>
                    </div>
                </template>

                <!-- Worker Dashboard -->
                <template x-if="user.account_type === 'worker'">
                    <div class="space-y-8">
                        <!-- Stats Row -->
                        <div class="grid grid-cols-1 gap-6 sm:grid-cols-3">
                            <!-- Jobs Completed -->
                            <div
                                class="bg-white dark:bg-gray-800 overflow-hidden shadow-lg rounded-xl border border-gray-100 dark:border-gray-700 transform hover:-translate-y-1 transition-all duration-300">
                                <div class="p-5">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0 bg-green-100 dark:bg-green-900/30 rounded-lg p-3">
                                            <i
                                                class="fas fa-check-circle text-green-600 dark:text-green-400 text-xl"></i>
                                        </div>
                                        <div class="ml-5 w-0 flex-1">
                                            <dl>
                                                <dt
                                                    class="text-sm font-medium text-gray-500 dark:text-gray-400 truncate">
                                                    Jobs Completed</dt>
                                                <dd class="text-3xl font-bold text-gray-900 dark:text-white mt-1"
                                                    x-text="workerStats.jobsCompleted"></dd>
                                            </dl>
                                        </div>
                                    </div>
                                </div>
                                <div
                                    class="bg-gray-50 dark:bg-gray-700/50 px-5 py-3 border-t border-gray-100 dark:border-gray-700">
                                    <div class="text-sm">
                                        <a href="/jobs/history"
                                            class="font-medium text-green-600 hover:text-green-500 dark:text-green-400">View
                                            history <span aria-hidden="true">&rarr;</span></a>
                                    </div>
                                </div>
                            </div>

                            <!-- Total Earnings -->
                            <div
                                class="bg-white dark:bg-gray-800 overflow-hidden shadow-lg rounded-xl border border-gray-100 dark:border-gray-700 transform hover:-translate-y-1 transition-all duration-300">
                                <div class="p-5">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0 bg-yellow-100 dark:bg-yellow-900/30 rounded-lg p-3">
                                            <i class="fas fa-wallet text-yellow-600 dark:text-yellow-400 text-xl"></i>
                                        </div>
                                        <div class="ml-5 w-0 flex-1">
                                            <dl>
                                                <dt
                                                    class="text-sm font-medium text-gray-500 dark:text-gray-400 truncate">
                                                    Total Earnings</dt>
                                                <dd class="text-3xl font-bold text-gray-900 dark:text-white mt-1"
                                                    x-text="'â‚¦' + workerStats.totalEarnings.toLocaleString()"></dd>
                                            </dl>
                                        </div>
                                    </div>
                                </div>
                                <div
                                    class="bg-gray-50 dark:bg-gray-700/50 px-5 py-3 border-t border-gray-100 dark:border-gray-700">
                                    <div class="text-sm">
                                        <a href="/wallet"
                                            class="font-medium text-yellow-600 hover:text-yellow-500 dark:text-yellow-400">View
                                            wallet <span aria-hidden="true">&rarr;</span></a>
                                    </div>
                                </div>
                            </div>

                            <!-- Rating -->
                            <div
                                class="bg-white dark:bg-gray-800 overflow-hidden shadow-lg rounded-xl border border-gray-100 dark:border-gray-700 transform hover:-translate-y-1 transition-all duration-300">
                                <div class="p-5">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0 bg-purple-100 dark:bg-purple-900/30 rounded-lg p-3">
                                            <i class="fas fa-star text-purple-600 dark:text-purple-400 text-xl"></i>
                                        </div>
                                        <div class="ml-5 w-0 flex-1">
                                            <dl>
                                                <dt
                                                    class="text-sm font-medium text-gray-500 dark:text-gray-400 truncate">
                                                    Rating</dt>
                                                <dd class="flex items-baseline mt-1">
                                                    <span class="text-3xl font-bold text-gray-900 dark:text-white"
                                                        x-text="workerStats.rating"></span>
                                                    <span class="ml-1 text-sm text-gray-500">/ 5.0</span>
                                                </dd>
                                            </dl>
                                        </div>
                                    </div>
                                </div>
                                <div
                                    class="bg-gray-50 dark:bg-gray-700/50 px-5 py-3 border-t border-gray-100 dark:border-gray-700">
                                    <div class="text-sm">
                                        <a href="/reviews"
                                            class="font-medium text-purple-600 hover:text-purple-500 dark:text-purple-400">View
                                            reviews <span aria-hidden="true">&rarr;</span></a>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            <!-- Active Contracts (Left Column) -->
                            <div
                                class="lg:col-span-2 bg-white dark:bg-gray-800 shadow-lg rounded-xl border border-gray-100 dark:border-gray-700 overflow-hidden">
                                <div
                                    class="px-6 py-5 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-gray-800/50">
                                    <div>
                                        <h3 class="text-lg leading-6 font-bold text-gray-900 dark:text-white">Active
                                            Contracts</h3>
                                        <p class="mt-1 max-w-2xl text-sm text-gray-500 dark:text-gray-400">Your current
                                            ongoing jobs.</p>
                                    </div>
                                    <a href="/jobs"
                                        class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-primary-700 bg-primary-100 hover:bg-primary-200 dark:bg-primary-900/30 dark:text-primary-300 transition-colors">
                                        Find More Work <i class="fas fa-arrow-right ml-1"></i>
                                    </a>
                                </div>
                                <ul class="divide-y divide-gray-200 dark:divide-gray-700">
                                    <template x-for="contract in contracts" :key="contract.id">
                                        <li
                                            class="px-6 py-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors">
                                            <div class="flex items-center justify-between">
                                                <div class="flex items-center gap-3">
                                                    <div
                                                        class="h-10 w-10 rounded-full bg-primary-100 dark:bg-primary-900/50 flex items-center justify-center text-primary-600 dark:text-primary-400">
                                                        <i class="fas fa-file-contract"></i>
                                                    </div>
                                                    <div>
                                                        <div class="text-sm font-bold text-gray-900 dark:text-white"
                                                            x-text="contract.title"></div>
                                                        <div
                                                            class="text-xs text-gray-500 dark:text-gray-400 flex items-center gap-2 mt-0.5">
                                                            <span><i class="fas fa-user mr-1"></i> <span
                                                                    x-text="contract.party_a_id"></span></span>
                                                            <span>&bull;</span>
                                                            <span><i class="fas fa-calendar mr-1"></i> Ends <span
                                                                    x-text="new Date(contract.end_date || Date.now()).toLocaleDateString()"></span></span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="flex-shrink-0">
                                                    <span
                                                        class="px-2.5 py-0.5 inline-flex text-xs font-medium rounded-full"
                                                        :class="{'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300': contract.status === 'active', 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300': contract.status === 'pending'}"
                                                        x-text="contract.status">
                                                    </span>
                                                </div>
                                            </div>
                                        </li>
                                    </template>
                                    <li x-show="contracts.length === 0" class="px-6 py-12 text-center">
                                        <div class="mx-auto h-12 w-12 text-gray-400">
                                            <i class="fas fa-clipboard-list text-4xl"></i>
                                        </div>
                                        <h3 class="mt-2 text-sm font-medium text-gray-900 dark:text-white">No active
                                            contracts</h3>
                                        <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">Get started by browsing
                                            available jobs.</p>
                                        <div class="mt-6">
                                            <a href="/jobs"
                                                class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
                                                <i class="fas fa-search mr-2"></i> Browse Jobs
                                            </a>
                                        </div>
                                    </li>
                                </ul>
                            </div>

                            <!-- Recent Applications (Right Column) -->
                            <div
                                class="bg-white dark:bg-gray-800 shadow-lg rounded-xl border border-gray-100 dark:border-gray-700 overflow-hidden h-fit">
                                <div
                                    class="px-6 py-5 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50">
                                    <h3 class="text-lg leading-6 font-bold text-gray-900 dark:text-white">Recent
                                        Applications</h3>
                                    <p class="mt-1 max-w-2xl text-sm text-gray-500 dark:text-gray-400">Jobs you've
                                        applied to recently.</p>
                                </div>
                                <div class="p-6">
                                    <div class="flow-root">
                                        <ul class="-mb-8">
                                            <template x-for="(app, index) in recentApplications" :key="app.id">
                                                <li>
                                                    <div class="relative pb-8">
                                                        <span x-show="index !== recentApplications.length - 1"
                                                            class="absolute top-4 left-4 -ml-px h-full w-0.5 bg-gray-200 dark:bg-gray-700"
                                                            aria-hidden="true"></span>
                                                        <div class="relative flex space-x-3">
                                                            <div>
                                                                <span
                                                                    class="h-8 w-8 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center ring-8 ring-white dark:ring-gray-800">
                                                                    <i
                                                                        class="fas fa-paper-plane text-blue-600 dark:text-blue-400 text-xs"></i>
                                                                </span>
                                                            </div>
                                                            <div
                                                                class="min-w-0 flex-1 pt-1.5 flex justify-between space-x-4">
                                                                <div>
                                                                    <p class="text-sm font-medium text-gray-900 dark:text-white"
                                                                        x-text="app.job_title"></p>
                                                                    <p
                                                                        class="text-xs text-gray-500 dark:text-gray-400 flex items-center mt-0.5">
                                                                        <i
                                                                            class="fas fa-map-marker-alt mr-1 text-gray-400"></i>
                                                                        <span x-text="app.location"></span>
                                                                    </p>
                                                                </div>
                                                                <div class="text-right text-sm whitespace-nowrap">
                                                                    <time
                                                                        class="text-gray-500 dark:text-gray-400 text-xs"
                                                                        x-text="new Date(app.date).toLocaleDateString(undefined, {month:'short', day:'numeric'})"></time>
                                                                    <div class="text-xs mt-1 font-medium capitalize px-2 py-0.5 rounded-full inline-block"
                                                                        :class="{
                                                                             'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300': app.status === 'pending', 
                                                                             'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300': app.status === 'accepted', 
                                                                             'bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300': app.status === 'rejected'
                                                                         }" x-text="app.status"></div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </li>
                                            </template>
                                            <li x-show="recentApplications.length === 0" class="text-center py-8">
                                                <div
                                                    class="inline-flex items-center justify-center h-10 w-10 rounded-full bg-gray-100 dark:bg-gray-700 mb-3">
                                                    <i class="fas fa-inbox text-gray-400"></i>
                                                </div>
                                                <p class="text-sm text-gray-500 dark:text-gray-400">No recent
                                                    applications.</p>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <!-- Upcoming Schedule (New Section) -->
                            <div
                                class="lg:col-span-3 bg-white dark:bg-gray-800 shadow-lg rounded-xl border border-gray-100 dark:border-gray-700 overflow-hidden mt-6">
                                <div
                                    class="px-6 py-5 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-gray-800/50">
                                    <div>
                                        <h3 class="text-lg leading-6 font-bold text-gray-900 dark:text-white">Upcoming
                                            Schedule</h3>
                                        <p class="mt-1 max-w-2xl text-sm text-gray-500 dark:text-gray-400">Your planned
                                            tasks and events.</p>
                                    </div>
                                    <button @click="openTaskModal()"
                                        class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 transition-colors">
                                        <i class="fas fa-plus mr-1"></i> Add Task
                                    </button>
                                </div>
                                <div class="p-6">
                                    <div x-show="isLoadingTasks" class="text-center py-4">
                                        <i class="fas fa-spinner fa-spin text-2xl text-primary-600"></i>
                                    </div>
                                    <ul x-show="!isLoadingTasks" class="divide-y divide-gray-200 dark:divide-gray-700">
                                        <template x-for="task in tasks" :key="task.id">
                                            <li class="py-4 flex items-center justify-between">
                                                <div class="flex items-center gap-3">
                                                    <button @click="toggleTaskStatus(task)"
                                                        class="text-gray-400 hover:text-green-500 transition-colors">
                                                        <i class="far"
                                                            :class="task.status === 'completed' ? 'fa-check-circle text-green-500' : 'fa-circle'"></i>
                                                    </button>
                                                    <div
                                                        :class="{'line-through text-gray-400': task.status === 'completed'}">
                                                        <p class="text-sm font-medium text-gray-900 dark:text-white"
                                                            x-text="task.title"></p>
                                                        <p class="text-xs text-gray-500 dark:text-gray-400"
                                                            x-text="task.due_date ? new Date(task.due_date).toLocaleDateString() : 'No due date'">
                                                        </p>
                                                    </div>
                                                </div>
                                                <button @click="deleteTask(task.id)"
                                                    class="text-gray-400 hover:text-red-500 transition-colors">
                                                    <i class="fas fa-trash-alt"></i>
                                                </button>
                                            </li>
                                        </template>
                                        <li x-show="tasks.length === 0"
                                            class="text-center py-8 text-gray-500 dark:text-gray-400">
                                            No upcoming tasks.
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </template>
            </div>
        </div>
</div>

<!-- Task Modal -->
<div x-show="showTaskModal" class="fixed z-50 inset-0 overflow-y-auto" style="display: none;">
    <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
        <div class="fixed inset-0 transition-opacity" aria-hidden="true">
            <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
        </div>
        <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
        <div
            class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
            <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white mb-4">Add New Task</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Title</label>
                        <input type="text" x-model="newTask.title"
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white sm:text-sm">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Due Date</label>
                        <input type="date" x-model="newTask.due_date"
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white sm:text-sm">
                    </div>
                </div>
            </div>
            <div class="bg-gray-50 dark:bg-gray-700 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                <button @click="createTask" type="button"
                    class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-primary-600 text-base font-medium text-white hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:ml-3 sm:w-auto sm:text-sm">
                    Add Task
                </button>
                <button @click="showTaskModal = false" type="button"
                    class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-500 shadow-sm px-4 py-2 bg-white dark:bg-gray-600 text-base font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                    Cancel
                </button>
            </div>
        </div>
    </div>
</div>
</template>

<!-- Admin Dashboard (Keep existing) -->
<template x-if="['admin', 'super_admin', 'moderator'].includes(user.account_type)">
    <div class="bg-white dark:bg-gray-800 shadow rounded-lg p-6">
        <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">Admin Controls</h3>
        <div class="grid grid-cols-1 gap-4 sm:grid-cols-3">
            <a href="/admin/users-page"
                class="block p-6 border border-gray-200 dark:border-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                <h4 class="font-bold text-gray-900 dark:text-white">User Management</h4>
            </a>
            <a href="/admin/moderation-page"
                class="block p-6 border border-gray-200 dark:border-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                <h4 class="font-bold text-gray-900 dark:text-white">Moderation</h4>
            </a>
        </div>
    </div>
</template>

</div>
</div>
</main>
</div>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/dashboard.js"></script>
{% endblock %}